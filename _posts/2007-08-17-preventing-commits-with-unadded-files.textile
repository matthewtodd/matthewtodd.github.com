--- 
title: Preventing Commits with Unadded Files
layout: post
---
Today I added a new file to an in-progress Rails app, watched all the tests pass, and committed. Except I forgot to <code>svn add</code> the new file. <strong>Again.</strong>

Doh.

<h3>Never Again</h3>

Subversion should <em>prevent me from checking in</em> if I've got unadded files in a project, right?

But looking through the <a href="http://svnbook.red-bean.com">Subversion book</a> and <code>man</code> pages, I couldn't find how to make it so. (<a href="http://svnbook.red-bean.com/nightly/en/svn.ref.reposhooks.pre-commit.html">Pre-commit hooks</a> run on the repository side, so they don't have access to your working copy.)

So, I've written a short Ruby script to help.

<h3>Introducing Doh</h3>

Whenever you <code>svn ci</code> with unadded files lying around, <code>doh</code> stops your commit:

<a href="http://www.flickr.com/photos/mtodd/1146644954/" title="Photo Sharing"><img src="http://farm2.static.flickr.com/1034/1146644954_c451bd6f2c.jpg" width="500" height="375" alt="Doh" /></a>

Cool, huh?

<h3>Installation</h3>

{% highlight bash %}
wget <a href="http://matthewtodd.org/svn/public/doh/bin/doh">http://matthewtodd.org/svn/public/doh/bin/doh</a>
{% endhighlight %}

And then create an alias, you know the drill:

{% highlight bash %}
alias svn='/full/path/to/doh'
{% endhighlight %}

<h3>Usage</h3>

Most of the time <code>doh</code> just does "<code>exec 'svn', *ARGV</code>", so it's safe as your full-time <code>svn</code> wrapper. It only kicks in if "<code>ci</code>" is one of the command-line arguments, and only then if there are unadded files in the current directory.

To temporarily override <code>doh</code>'s behavior and commit anyway, just prefix the <code>svn</code> with a backslash:

{% highlight bash %}
\\svn ci -m "don't worry, I know what I'm doing"
{% endhighlight %}

<h3>Feedback</h3>

I'd love to hear if you decide to give <code>doh</code> a try---or if there's some built-in way to achieve the same goal in Subversion! I'll be glad to turn this into a gem if there's any demand for it.

Enjoy!
